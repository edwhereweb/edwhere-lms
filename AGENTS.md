# Edwhere LMS — Project Conventions

> This file defines coding standards for AI-assisted development tools (Cursor, GitHub Copilot, Windsurf, etc.) and for human contributors. Follow these conventions for all changes.

## Tech Stack

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript (strict)
- **Database**: MongoDB via Prisma ORM
- **Auth**: Clerk (`@clerk/nextjs`)
- **Payments**: Razorpay (INR currency)
- **Video**: Mux (upload) + YouTube (embed)
- **Uploads**: UploadThing
- **UI**: Tailwind CSS + shadcn/ui
- **Forms**: React Hook Form + Zod
- **State**: Zustand (client), React Context (theme)

## Project Structure

```
app/                    # Next.js App Router pages and API routes
  (course)/             # Course consumption layout group
  (dashboard)/          # Dashboard layout group (teacher + student)
  api/                  # API route handlers
actions/                # Server-side data fetching functions
components/             # Shared React components
  ui/                   # shadcn/ui generated components — do NOT manually edit
  providers/            # Context providers
hooks/                  # Custom React hooks
lib/                    # Utilities, config, and shared logic
prisma/                 # Prisma schema and seed scripts
types/                  # Shared TypeScript type definitions
```

## Code Style

- Formatting: **Prettier** (config in `.prettierrc`) — single quotes, no trailing commas, 100 char print width.
- Linting: **ESLint** (config in `.eslintrc.json`) — extends `next/core-web-vitals`, `next/typescript`, `prettier`.
- Pre-commit: **Husky** + **lint-staged** run formatting and linting on staged files automatically.
- Never use `any`. Use `unknown` and narrow types, or define proper interfaces.
- Prefix intentionally unused variables with `_` (e.g., `_params`, `_event`).
- Use `import type` for type-only imports from Prisma and other libraries.
- Do NOT use raw `console.log` for debugging. Use `debug(tag, ...args)` from `lib/debug.ts` instead — it is gated behind the `ENABLE_DEBUG_LOGS` env var and outputs nothing in production.
- Do not add comments that merely narrate what the code does. Comments should explain _why_, not _what_.

## API Routes

All API route handlers in `app/api/` must follow this pattern:

1. **Auth check** first — `auth()` from Clerk.
2. **Validate request body** — Zod schemas from `lib/validations.ts`, validated via `validateBody()` from `lib/api-utils.ts`.
3. **Return errors** — `apiError(message, status)` from `lib/api-utils.ts`.
4. **Catch all** — `handleApiError(tag, error)` from `lib/api-utils.ts`.

```typescript
import { auth } from '@clerk/nextjs/server';
import { NextResponse } from 'next/server';
import { validateBody, apiError, handleApiError } from '@/lib/api-utils';
import { mySchema } from '@/lib/validations';

export async function POST(req: Request) {
  try {
    const { userId } = await auth();
    if (!userId) return apiError('Unauthorized', 401);

    const body = await req.json();
    const validation = validateBody(mySchema, body);
    if (!validation.success) return validation.response;

    // ... business logic ...

    return NextResponse.json(result);
  } catch (error) {
    return handleApiError('MY_ROUTE', error);
  }
}
```

- Add all new Zod schemas to `lib/validations.ts` — do not define inline schemas in route files.

## Client Components

- Error handling: use `toast.error("Something went wrong")` in generic catch blocks.
- Never swallow errors with `.catch(() => {})` — at minimum show a toast to the user.
- After mutations: call `router.refresh()` to revalidate server data.
- After delete + navigate: call `router.push()` _before_ `router.refresh()`.

## Database

- Always import the Prisma singleton from `lib/db.ts` — never instantiate `PrismaClient` elsewhere.
- Avoid N+1 queries: use `include`, `select`, or batch with `Promise.all`.
- Never instantiate third-party SDK clients (Mux, Razorpay, etc.) at the module top-level — use lazy initialization via a getter function. Top-level instantiation crashes the build when env vars are unavailable.

## Files and Naming

- React components: `kebab-case.tsx` files with `PascalCase` named exports.
- Page-specific components: colocate in a `_components/` subdirectory next to the page.
- Hooks: `use-kebab-case.ts` (e.g., `use-debounce.ts`).
- Lib modules: `kebab-case.ts` in `lib/`.
- Do NOT edit files in `components/ui/` — these are generated by shadcn/ui.

## Environment Variables

- All required env vars are validated at startup via `lib/env.ts` using Zod.
- When adding a new env var: update three places — `lib/env.ts`, `.env.example`, and `.github/workflows/ci.yml`.

## What NOT to Do

- Do not create Dockerfiles, CI/CD configs, or deployment infrastructure unless explicitly asked.
- Do not add rate limiting, caching layers, or abstractions that aren't immediately needed.
- Do not create README or documentation files unless explicitly asked.
- Do not refactor working code purely for style — only fix actual bugs or clear violations.
- Do not over-engineer. Keep things simple. If a pattern is only used once, don't abstract it.
